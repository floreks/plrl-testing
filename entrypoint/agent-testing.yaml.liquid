{% assign cluster = configuration.cluster | default: "floreks-kind" %}

apiVersion: deployments.plural.sh/v1alpha1
kind: Cluster
metadata:
  name: {{ cluster }}
  namespace: testing
spec:
  handle: {{ cluster }}

---

apiVersion: deployments.plural.sh/v1alpha1
kind: GitRepository
metadata:
  name: agent-testing
  namespace: testing
spec:
  url: https://github.com/floreks/agent-testing

---

apiVersion: deployments.plural.sh/v1alpha1
kind: ServiceDeployment
metadata:
  name: agent-testing
  namespace: testing
spec:
  namespace: testing
  repositoryRef:
    name: agent-testing
    namespace: testing
  git:
    folder: services/agent
    ref: main
  configuration:
    cluster: {{ cluster }}
  clusterRef:
    kind: Cluster
    name: mgmt
    namespace: infra