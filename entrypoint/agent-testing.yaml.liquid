{% assign cluster = configuration.cluster | default: "floreks-kind" %}
{% assign name = "agent-testing" %}
{% assign namespace = "testing" %}

apiVersion: deployments.plural.sh/v1alpha1
kind: Cluster
metadata:
  name: {{ cluster }}
  namespace: {{ namespace }}
spec:
  handle: {{ cluster }}

---

apiVersion: deployments.plural.sh/v1alpha1
kind: GitRepository
metadata:
  name: {{ name }}
  namespace: {{ namespace }}
spec:
  url: https://github.com/floreks/plrl-testing.git

---

apiVersion: deployments.plural.sh/v1alpha1
kind: ServiceDeployment
metadata:
  name: {{ name }}
  namespace: {{ namespace }}
spec:
  namespace: {{ namespace }}
  repositoryRef:
    name: {{ name }}
    namespace: {{ namespace }}
  git:
    folder: services/agent
    ref: main
  configuration:
    cluster: {{ cluster }}
    repositoryName: {{ name }}
    repositoryNamespace: {{ namespace }}
  clusterRef:
    kind: Cluster
    name: mgmt
    namespace: infra